name: deploy to aliyun oss

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    # 切代码到 runner
    - uses: actions/checkout@v1
      with:
        submodules: true
    # 下载 git submodule
    - uses: srt32/git-actions@v0.0.3
      with:
        args: git submodule update --init --recursive
    # 使用 node:10
    - name: use Node.js 10.x
      uses: actions/setup-node@v1
      with:
        node-version: 10.x
    # npm install
    - name: npm install and build
      run: |
        npm install
        npm run docs:build
      env:
        CI: true
    # 设置阿里云OSS的 id/secret，存储到 github 的 secrets 中
    - name: setup aliyun oss
      uses: manyuanrong/setup-ossutil@master
      with:
        endpoint: oss-cn-shanghai.aliyuncs.com
        access-key-id: ${{ secrets.OSS_KEY_ID }}
        access-key-secret: ${{ secrets.OSS_KEY_SECRET }}
    - name: cp files to aliyun
      run: ossutil cp -rf .vuepress/dist oss://eureka-blog/
# # workflow name
# name: Hexo Blog CI

# # 在main分支上有push命令时触发该流程
# on:
#     push:
#         branches:
#             - main

# jobs:
#     build:
#         runs-on: ubuntu-latest

#         steps:
#             - name: Checkout Repository master branch
#               uses: actions/checkout@master

#             - name: Setup Node.js 10.x
#               uses: actions/setup-node@master
#               with:
#                   node-version: '10.x'

#             - name: Setup Hexo Dependencies
#               run: |
#                   # npm install  # 若没有上传依赖包，则把这行的注释解除
#                   npm install -g hexo-cli
#                   hexo clean
#                   hexo generate
#                   gulp  # 我安装了压缩静态文件的插件，若没有安装，将这行删除
#             - name: setup aliyun oss
#               uses: manyuanrong/setup-ossutil@master
#               with:
#                   endpoint: oss-cn-hangzhou.aliyuncs.com
#                   access-key-id: ${{ secrets.KEY }} # 刚刚配置过的AccessKeyId
#                   access-key-secret: ${{ secrets.SECRET }} # 刚刚配置过的AccessKeySecret
#             - name: cp files to aliyun
#               run: ossutil cp -rf public oss://xxxxx/ # 将xxxxx改为创建的Bucket名称，-rf表示覆盖
